!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Jotted=b()}(this,function(){"use strict";function a(){return'\n    <ul class="jotted-nav">\n      <li class="jotted-nav-item jotted-nav-item-result">\n        <a href="#" data-jotted-type="result">\n          Result\n        </a>\n      </li>\n      <li class="jotted-nav-item jotted-nav-item-html">\n        <a href="#" data-jotted-type="html">\n          HTML\n        </a>\n      </li>\n      <li class="jotted-nav-item jotted-nav-item-css">\n        <a href="#" data-jotted-type="css">\n          CSS\n        </a>\n      </li>\n      <li class="jotted-nav-item jotted-nav-item-js">\n        <a href="#" data-jotted-type="js">\n          JavaScript\n        </a>\n      </li>\n    </ul>\n    <div class="jotted-pane jotted-pane-result"></div>\n    <div class="jotted-pane jotted-pane-html"></div>\n    <div class="jotted-pane jotted-pane-css"></div>\n    <div class="jotted-pane jotted-pane-js"></div>\n  '}function b(a){return"jotted-pane-active-"+a}function c(){return"jotted"}function d(){return"jotted-nav-show-blank"}function e(a){return"jotted-has-"+a}function f(a){return"jotted-editor jotted-editor-"+a}function g(a){var b=arguments.length<=1||void 0===arguments[1]?"":arguments[1];return'\n    <textarea data-jotted-type="'+a+'" data-jotted-file="'+b+'"></textarea>\n    <div class="jotted-status"></div>\n  '}function h(a){return"\n    <p>"+a+"</p>\n  "}function i(a){return"jotted-status-"+a}function j(a){return"jotted-status-active-"+a}function k(a){return"jotted-plugin-"+a}function l(){var a=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return"\n    <!doctype html>\n    <html>\n    <head>\n    </head>\n    <body>\n    "+a+"\n    </body>\n    </html>\n  "}function m(a){return"Loading <strong>"+a+"</strong>.."}function n(a){return"There was an error loading <strong>"+a+"</strong>."}function o(){var a=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],b=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],c={};return Object.keys(b).forEach(function(d){"undefined"!=typeof a[d]?c[d]=a[d]:c[d]=b[d]}),c}function p(a,b){var c=new window.XMLHttpRequest;c.open("GET",a),c.responseType="text",c.onload=function(){200===c.status?b(null,c.responseText):b(a,c)},c.onerror=function(a){b(a)},c.send()}function q(a,b,c,d,e){return function(b,f){b&&d.push(b),a++,a===c.length?e(d,f):r(a,f,c,d,e)}}function r(a,b,c,d,e){c[a](b,q.apply(this,arguments))}function s(a,b){var c=arguments.length<=2||void 0===arguments[2]?function(){}:arguments[2],d=[];return a.length?void r(0,b,a,d,c):c(d,b)}function t(a,b){var c=null;return function(){var d=this,e=arguments;clearTimeout(c),c=setTimeout(function(){a.apply(d,e)},b)}}function u(){console.log(arguments)}function v(a,b){return a.className+=" "+b,a.className}function w(a,b){var c=" "+b,d=b+" ";return-1!==a.className.indexOf(c)?a.className=a.className.replace(c,""):-1!==a.className.indexOf(d)?a.className=a.className.replace(d,""):a.className=a.className.replace(b,""),a.className}function x(a,b){return a.getAttribute("data-"+b)}function y(a){var b=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1],c=document.createElement("script");c.type="text/javascript",a.src?(c.onload=function(){setTimeout(b)},c.onerror=b,c.src=a.src):c.textContent=a.innerText,this._get("$resultFrame").contentWindow.document.head.appendChild(c),a.parentNode.removeChild(a),a.src||b()}function z(){for(var a=this,b=this._get("$resultFrame").contentWindow.document.body.querySelectorAll("script"),c=b.length,d=[],e=function(c){d.push(function(d,e){y.call(a,b[c],e)})},f=0;c>f;f++)e(f);s(d)}function A(a){for(var b in F){var c=F[b];if(c._id===a)return c}throw new Error("Plugin "+a+" is not registered.")}function B(a,b){b._id=a,F.push(b)}function C(){var a=this;this._get("options").plugins.forEach(function(b){var c=void 0,d=void 0,e={};"string"==typeof b?d=b:"object"===("undefined"==typeof b?"undefined":E["typeof"](b))&&(d=b.name,e=b.options||{}),c=A(d),a._get("plugins")[b]=new c(a,e),v(a._get("$container"),k(d))})}function D(a){a.plugin("codemirror",N),a.plugin("ace",M),a.plugin("less",L),a.plugin("coffeescript",K),a.plugin("stylus",J),a.plugin("babel",I),a.plugin("markdown",H)}var E={};E["typeof"]=function(a){return a&&"undefined"!=typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},E.classCallCheck=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},E.createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();var F=[],G=function(){function a(){E.classCallCheck(this,a),this.topics={},this.callbacks={}}return E.createClass(a,[{key:"find",value:function(a){return this.topics[a]=this.topics[a]||[],this.topics[a]}},{key:"subscribe",value:function(a,b){var c=arguments.length<=2||void 0===arguments[2]?90:arguments[2],d=this.find(a);b._priority=c,d.push(b),d.sort(function(a,b){return a._priority>b._priority?1:b._priority>a._priority?-1:0})}},{key:"unsubscribe",value:function(a,b){var c=this.find(a);c.forEach(function(a){if(!b)return void(a.length=0);var c=[].indexOf.call(a,b);return-1===c?u("Subscriber not found in topic"):void a.splice(c,1)})}},{key:"publish",value:function(a){var b=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],c=this.find(a),d=[];c.forEach(function(a){d.push(a)}),s(d,b,this.runCallbacks(a))}},{key:"runCallbacks",value:function(a){var b=this;return function(){var c=this,d=arguments;b.callbacks[a]=b.callbacks[a]||[],b.callbacks[a].forEach(function(a){a.apply(c,d)})}}},{key:"done",value:function(a){var b=arguments.length<=1||void 0===arguments[1]?function(){}:arguments[1];this.callbacks[a]=this.callbacks[a]||[],this.callbacks[a].push(b)}}]),a}(),H=function(){function a(b,c){E.classCallCheck(this,a);var d=20;this.options=o(c,{}),"undefined"!=typeof window.marked&&(window.marked.setOptions(c),b.$container.querySelector('a[data-jotted-type="html"]').innerHTML="Markdown",b.on("change",this.change.bind(this),d))}return E.createClass(a,[{key:"change",value:function(a,b){if("html"===a.type){try{a.content=window.marked(a.content)}catch(c){return b(c,a)}b(null,a)}else b(null,a)}}]),a}(),I=function(){function a(b,c){E.classCallCheck(this,a);var d=20;this.options=o(c,{presets:["es2015"]}),"undefined"!=typeof window.Babel&&(b.$container.querySelector('a[data-jotted-type="js"]').innerHTML="ES2015",b.on("change",this.change.bind(this),d))}return E.createClass(a,[{key:"change",value:function(a,b){if("js"===a.type){try{a.content=window.Babel.transform(a.content,this.options).code}catch(c){return b(c,a)}b(null,a)}else b(null,a)}}]),a}(),J=function(){function a(b,c){E.classCallCheck(this,a);var d=20;c=o(c,{}),"undefined"!=typeof window.stylus&&(b.$container.querySelector('a[data-jotted-type="css"]').innerHTML="Stylus",b.on("change",this.change.bind(this),d))}return E.createClass(a,[{key:"isStylus",value:function(a){return"css"!==a.type?!1:-1!==a.file.indexOf(".styl")||""===a.file}},{key:"change",value:function(a,b){this.isStylus(a)?window.stylus(a.content,this.options).render(function(c,d){return c?b(c,a):(a.content=d,void b(null,a))}):b(null,a)}}]),a}(),K=function(){function a(b,c){E.classCallCheck(this,a);var d=20;c=o(c,{}),"undefined"!=typeof window.CoffeeScript&&(b.$container.querySelector('a[data-jotted-type="js"]').innerHTML="CoffeeScript",b.on("change",this.change.bind(this),d))}return E.createClass(a,[{key:"isCoffee",value:function(a){return"js"!==a.type?!1:-1!==a.file.indexOf(".coffee")||""===a.file}},{key:"change",value:function(a,b){if(this.isCoffee(a))try{a.content=window.CoffeeScript.compile(a.content)}catch(c){return b(c,a)}b(null,a)}}]),a}(),L=function(){function a(b,c){E.classCallCheck(this,a);var d=20;c=o(c,{}),"undefined"!=typeof window.less&&(b.$container.querySelector('a[data-jotted-type="css"]').innerHTML="Less",b.on("change",this.change.bind(this),d))}return E.createClass(a,[{key:"isLess",value:function(a){return"css"!==a.type?!1:-1!==a.file.indexOf(".less")||""===a.file}},{key:"change",value:function(a,b){this.isLess(a)?window.less.render(a.content,this.options,function(c,d){return c?b(c,a):(a.content=d.css,void b(null,a))}):b(null,a)}}]),a}(),M=function(){function a(b,c){var d=this;E.classCallCheck(this,a);var e,f=1;if(this.editor={},this.modemap={html:"html",css:"css",js:"javascript",less:"less",coffee:"coffeescript"},c=o(c,{}),"undefined"!=typeof window.ace){var g=b.$container.querySelectorAll(".jotted-editor"),h=function(){var a=g[e].querySelector("textarea"),f=x(a,"jotted-type"),h=x(a,"jotted-file"),i=document.createElement("div");g[e].appendChild(i),d.editor[f]=window.ace.edit(i);var j=d.editor[f],k=o(c);j.getSession().setMode(d.aceMode(f,h)),j.getSession().setOptions(k),j.$blockScrolling=1/0,j.on("change",function(){a.value=j.getValue(),b.trigger("change",{aceEditor:j,type:f,file:h,content:a.value})})};for(e=0;e<g.length;e++)h();b.on("change",this.change.bind(this),f)}}return E.createClass(a,[{key:"change",value:function(a,b){var c=this.editor[a.type];a.aceEditor||c.getSession().setValue(a.content),a.content=c.getValue(),b(null,a)}},{key:"aceMode",value:function(a,b){var c="ace/mode/";for(var d in this.modemap)if(-1!==b.indexOf("."+d))return c+this.modemap[d];for(var d in this.modemap)if(a===d)return c+this.modemap[d];return c+a}}]),a}(),N=function(){function a(b,c){var d=this;E.classCallCheck(this,a);var e,f=1;if(this.editor={},c=o(c,{lineNumbers:!0}),"undefined"!=typeof window.CodeMirror){var g=b.$container.querySelectorAll(".jotted-editor"),h=function(){var a=g[e].querySelector("textarea"),f=x(a,"jotted-type"),h=x(a,"jotted-file");d.editor[f]=window.CodeMirror.fromTextArea(a,c);var i=d.editor[f];i.on("change",function(){a.value=i.getValue(),b.trigger("change",{cmEditor:i,type:f,file:h,content:a.value})})};for(e=0;e<g.length;e++)h();b.on("change",this.change.bind(this),f)}}return E.createClass(a,[{key:"change",value:function(a,b){var c=this.editor[a.type];a.cmEditor||c.setValue(a.content),a.content=c.getValue(),b(null,a)}}]),a}(),O=function(){function k(e,f){if(E.classCallCheck(this,k),!e)throw new Error("Can't find Jotted container.");var g={};this._get=function(a){return g[a]},this._set=function(a,b){return g[a]=b,g[a]};var h=this._set("options",o(f,{files:[],showBlank:!1,runScripts:!0,pane:"result",debounce:250,plugins:[]}));h.showBlank&&v(l,d());var i=this._set("pubsoup",new G);this._set("trigger",t(i.publish.bind(i),h.debounce)),this._set("on",function(){i.subscribe.apply(i,arguments)}),this._set("off",function(){i.unsubscribe.apply(i,arguments)});var j=this._set("done",function(){i.done.apply(i,arguments)});j("change",this.changeCallback.bind(this));var l=this._set("$container",e);l.innerHTML=a(),v(l,c());var m=this._set("paneActive",h.pane);v(l,b(m)),this._set("$status",{});for(var n=["html","css","js"],p=0;p<n.length;p++){var q=n[p];this.markup(q)}this.createResultFrame(),l.addEventListener("change",t(this.change.bind(this),h.debounce)),l.addEventListener("keyup",t(this.change.bind(this),h.debounce)),l.addEventListener("click",this.pane.bind(this)),this.$container=this._get("$container"),this.on=this._get("on"),this.off=this._get("off"),this.done=this._get("done"),this.trigger=this._get("trigger"),this.paneActive=this._get("paneActive"),this._set("plugins",{}),C.call(this);for(var r=["html","css","js"],s=0;s<r.length;s++){var q=r[s];this.load(q)}}return E.createClass(k,[{key:"findFile",value:function(a){var b={},c=this._get("options");for(var d in c.files){var e=c.files[d];if(e.type===a)return e}return b}},{key:"markup",value:function(a){var b=this._get("$container"),c=b.querySelector(".jotted-pane-"+a),d=this.findFile(a),h=document.createElement("div");h.innerHTML=g(a,d.url),h.className=f(a),c.appendChild(h),this._get("$status")[a]=c.querySelector(".jotted-status"),("undefined"!=typeof d.url||"undefined"!=typeof d.content)&&v(b,e(a))}},{key:"load",value:function(a){var b=this,c=this.findFile(a),d=this._get("$container").querySelector(".jotted-pane-"+a+" textarea");"undefined"!=typeof c.content?this.setValue(d,c.content):"undefined"!=typeof c.url&&(this.status("loading",[m(c.url)],{type:a,file:c}),p(c.url,function(c,e){return c?void b.status("error",[n(c)],{type:a}):(b.clearStatus("loading",{type:a}),void b.setValue(d,e))}))}},{key:"setValue",value:function(a,b){a.value=b,this.change({target:a})}},{key:"change",value:function(a){x(a.target,"jotted-type")&&this._get("pubsoup").publish("change",{type:x(a.target,"jotted-type"),file:x(a.target,"jotted-file"),content:a.target.value})}},{key:"createResultFrame",value:function(){var a=(arguments.length<=0||void 0===arguments[0]?"":arguments[0],document.createElement("style")),b=this._get("$styleInject");b&&(a.textContent=b.textContent),b=this._set("$styleInject",a);var c=this._get("$container").querySelector(".jotted-pane-result"),d=this._get("$resultFrame");d&&c.removeChild(d),d=this._set("$resultFrame",document.createElement("iframe")),c.appendChild(d);var e=d.contentWindow.document;e.open(),e.write(l()),e.close(),e.head.appendChild(b)}},{key:"changeCallback",value:function(a,b){this.status("error",a,b);var c=this._get("options");if("html"===b.type)return c.runScripts&&this.createResultFrame(),this._get("$resultFrame").contentWindow.document.body.innerHTML=b.content,void(c.runScripts&&z.call(this));if("css"===b.type)return void(this._get("$styleInject").textContent=b.content);if("js"!==b.type);else try{this._get("$resultFrame").contentWindow.eval(b.content)}catch(d){a.length||this.status("error",[d.message],{type:"js"})}}},{key:"pane",value:function(a){if(x(a.target,"jotted-type")){var c=this._get("$container"),d=this._get("paneActive");w(c,b(d)),d=this._set("paneActive",x(a.target,"jotted-type")),v(c,b(d)),a.preventDefault()}}},{key:"status",value:function(){var a=arguments.length<=0||void 0===arguments[0]?"error":arguments[0],b=arguments.length<=1||void 0===arguments[1]?[]:arguments[1],c=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(!b.length)return this.clearStatus(a,c);var d=this._get("$status");v(d[c.type],i(a)),v(this._get("$container"),j(c.type));var e="";b.forEach(function(a){e+=h(a)}),d[c.type].innerHTML=e}},{key:"clearStatus",value:function(a,b){var c=this._get("$status");w(c[b.type],i(a)),w(this._get("$container"),j(b.type)),c[b.type].innerHTML=""}}]),k}();return O.plugin=function(){return B.apply(this,arguments)},D(O),O});